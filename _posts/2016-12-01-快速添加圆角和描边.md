---
layout:     post
title:      基于AudioContext直接播放AMR文件
subtitle:   关于音频原生API的使用
date:       2018-09-30
author:     CNJ
header-img: img/post-bg-audio-web.jpg
catalog: true
tags:
    - WEB
    - 开发技巧
---

# 前言

随着微信的兴起，语音聊天是一种与文字交流不同的交流方式。很多互联网产品，例如金融类APP、游戏类APP等除了会加入传统的文字聊天模块，有些APP也会加入语音聊天模块。

我们来说说如何对某个控件进行圆角、描边处理：
# 业务背景
一般语音的数据量比较大，通常会用amr格式作为存储格式，移动端APP可以调用底层模块进行读取amr格式的文件，但是如果开发的是WEB应用，就比较麻烦了，因为如果直接使用'<audio>'标签的src属性读取服务器文件，没办法识别amr格式文件。因此，引入了一个Web API [AudioContext](https://developer.mozilla.org/zh-CN/docs/Web/API/AudioContext/AudioContext) 。

如下代码：

```
self.myButton.layer.cornerRadius = 20;
self.myButton.layer.masksToBounds = YES;
self.myButton.layer.borderWidth = 2;
self.myButton.layer.borderColor = [UIColor blackColor].CGColor;
```
这样不仅需要Storyboard关联出属性，还要写一堆代码对属性进行设置，不得不说实在麻烦~

# 中级
更聪明的做法是使用Storyboard提供的Runtime Attributes为控件添加圆角描边。

选中控件，然后在Runtime Attributes框中输入对应的`Key`与`Type`与`Value`,这样程序在运行时就会通过KVC为你的控件属性进行赋值。(不仅仅是圆角、描边~)

如下图

![](http://ww4.sinaimg.cn/large/7853084cgw1fabg89aeqkj207b08j74y.jpg)

设置圆角、描边的Key为：

```
layer.borderWidth
layer.borderColorFromUIColor
layer.cornerRadius
clipsToBounds
```
我这次在测试时，

这样做不用关联出属性，但是需要输入大串字符串，也是不够方便。

# 高级

创建UIView的分类，使用`IBInspectable`+ `IB_DESIGNABLE`关键字：

```
#import <UIKit/UIKit.h>

IB_DESIGNABLE

@interface UIView (Inspectable)

@property(nonatomic,assign) IBInspectable CGFloat cornerRadius;
@property(nonatomic,assign) IBInspectable CGFloat borderWidth;
@property(nonatomic,assign) IBInspectable UIColor *borderColor;

@end
```

```
#import "UIView+Inspectable.h"

@implementation UIView (Inspectable)

-(void)setCornerRadius:(CGFloat)cornerRadius{
    self.layer.masksToBounds = YES;
    self.layer.cornerRadius = cornerRadius;
}
-(void)setBorderColor:(UIColor *)borderColor{
    self.layer.borderColor = borderColor.CGColor;
}
-(void)setBorderWidth:(CGFloat)borderWidth{
    self.layer.borderWidth = borderWidth;
}

- (CGFloat)cornerRadius{
    return self.layer.cornerRadius;
}
- (CGFloat)borderWidth{
    return self.layer.borderWidth;
}
- (UIColor *)borderColor{
    return [UIColor colorWithCGColor:self.layer.borderColor];
}

@end
```

附上：[GitHub地址](https://github.com/qiubaiying/CircularAndStroke.git)


#### 直接使用

直接将这两个文件拖入项目中即可使用，在右边栏将会显示圆角和描边的属性设置

如图：

![](http://ww4.sinaimg.cn/large/7853084cgw1facfqugjtbj20mp07v401.jpg)

#### 动态显示设置效果

直接使用的话只有在运行时才能看到效果，

例如要实时显示一个`UIBUtton`圆角、描边效果，需要创建一个类继承`UIButton`

```
#import <UIKit/UIKit.h>
#import "UIView+Inspectable.h"

@interface myButton : UIButton

@end
```

```
#import "myButton.h"

@implementation myButton

@end
```

只要将button的Class选择该空白类即可

关于`IBInspectable`与`IB_DESIGNABLE`的使用详情可以参考这篇文章[《谈不完美的IBDesignable/IBInspectable可视化效果编程》](http://www.jianshu.com/p/a90e44ba1f2b)